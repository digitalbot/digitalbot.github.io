<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Tag: cpanm | About Digital]]></title>
  <link href="http://blog.digital-bot.com/blog/tags/cpanm/atom.xml" rel="self"/>
  <link href="http://blog.digital-bot.com/"/>
  <updated>2013-11-01T23:38:42+09:00</updated>
  <id>http://blog.digital-bot.com/</id>
  <author>
    <name><![CDATA[digital_bot]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Web::Queryのtestがコケた話]]></title>
    <link href="http://blog.digital-bot.com/blog/2013/10/28/install-web-query/"/>
    <updated>2013-10-28T15:09:00+09:00</updated>
    <id>http://blog.digital-bot.com/blog/2013/10/28/install-web-query</id>
    <content type="html"><![CDATA[<p>先日、CentoOSにWeb::Queryを入れようとしたらこけてハマってた。レガシーなシステムでの使用だったので当然<code>Carton</code>なんか使ってないし、モジュールはそれぞれのサーバに入って直接<code>cpanm</code>する形だったが、やはりこういったレガシーな開発手順というのは早めに駆逐されたほうが世の(開発者)のためだと感じた。</p>

<p>開発環境では一発で入ってたし、試しにと手元のMBAに<code>cpanm Web::Query</code>しても問題なく入ったのに、肝心の本番サーバでWeb::Queryが入らない。テストでこけてる。その他perl5.8.8を新規に入れたまっさら状態のサーバを用意して試しても見たけど再現しない。なんなんだ。</p>

<p>ためしに最新版ではない、0.16とかいくつか古いバージョンのWeb::Queryも試したけれど、特に違いはうまれなかったので、最近の変更が原因ではなさそう。</p>

<p>サマリーだけ抜き出すとこんな感じ</p>

<p>```</p>

<h2>Failed Test        Stat Wstat Total Fail  Failed  List of Failed</h2>

<p>t/07_remove.t         2   512    10    2  20.00%  2-3
t/08_indent.t         1   256     2    1  50.00%  1
t/09_as_html.t        8  2048     8    8 100.00%  1-8
t/add.t               4  1024     8    4  50.00%  1-4
t/add_class.t         2   512     4    2  50.00%  1-2
t/after.t             1   256     2    1  50.00%  1
t/append.t            1   256     2    1  50.00%  1
t/before.t            1   256     2    1  50.00%  1
t/clone.t             1   256     2    1  50.00%  1
t/contents.t          2   512     4    2  50.00%  1-2
t/detach.t            2   512     6    2  33.33%  1-2
t/insert_after.t      1   256     2    1  50.00%  1
t/insert_before.t     1   256     2    1  50.00%  1
t/prepend.t           1   256     2    1  50.00%  1
t/remove_class.t      2   512     6    2  33.33%  2-3
t/replace_with.t      4  1024     8    4  50.00%  1-4
t/store_comments.t    2   512     4    2  50.00%  1-2
Failed 17/28 test scripts, 39.29% okay. 36/135 subtests failed, 73.33% okay.
FAIL
```</p>

<!-- more -->


<h2>HTML::Element</h2>

<p>結論からいうと<strong>HTML::Element</strong>が入ってなかった。</p>

<p>Web::Queryの依存モジュールに入ってないから必ずしもHTML::Elementが必要なわけではないのだろうけど(というか依存モジュール入れる時点で入りそうなもんだけど)、これがないと何故か'\n'が<code>wq-&gt;as_html</code>だかの結果に入り込んでテスト結果が誤判定？されてしまっていた。<code>cpanm --look Web::Query</code>してテストを自分で書き換えたりもしてみたら、どうにもやはりこの"\n"が問題のようなんだけど、これはなんでだろう。</p>

<p>「これは何かおかしい」と思って、適当に関係しそうっぽいモジュールを入れてから再度<code>cpanm</code>すると、今度は何事もなかったかのようにインストールされた。それが<strong>HTML::Element</strong>だった。他にもHTML::ParserとかXML::LibXMLとか色々入れなおしたけど、やっかいなのはこれな気がする。</p>

<p>何が面倒かって、特にモジュールが足りてない(Can&rsquo;t locate~)とか言われずに、淡々とテストの文字列比較で落ちてるのが面倒だった。</p>

<h2>おわりに</h2>

<p><a href="https://gist.github.com/digitalbot/7200263">一応エラーのログを貼っておこうかと思う</a>。結局技術的に踏み込んで解決策を見出したわけでもないゆるふわな記事だけど、まぁそういう風にハマってた人もいたってことで。</p>

<p>ちなみに、このWeb::Query、とても便利。</p>
]]></content>
  </entry>
  
</feed>
